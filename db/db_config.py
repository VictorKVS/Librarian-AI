# üìÑ db/db_config.py
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—É—Ç–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ä–µ–¥—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

import os
import platform
import socket

def get_database_url() -> str:
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ –≤—Å–µ–≥–æ
    env_url = os.getenv("DATABASE_URL")
    if env_url:
        return env_url

    # 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ hostname (–Ω–∞–ø—Ä–∏–º–µ—Ä, Google Colab)
    hostname = socket.gethostname()
    if "colab" in hostname or "instance" in hostname:
        return "sqlite:////content/drive/MyDrive/librarian.db"

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –û–° –∏–ª–∏ –ø—É—Ç–µ–π –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫)
    if platform.system() == "Linux" and os.path.exists("/mnt/yandex-disk/"):
        return "sqlite:////mnt/yandex-disk/librarian.db"

    # 4. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å —Ñ–ª–µ—à–∫–∏)
    return "sqlite:///db/librarian.db"

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    print(f"üîå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –ø–æ –ø—É—Ç–∏: {get_database_url()}")

"""
üìÑ db/db_config.py
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (SQLite –∏–ª–∏ –¥—Ä—É–≥–æ–π) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ä–µ–¥—ã:

–ß–∏—Ç–∞–µ—Ç DATABASE_URL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∞)

–†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç Google Colab, –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫, —Ñ–ª–µ—à–∫—É

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π sqlalchemy.url –¥–ª—è SQLAlchemy –∏–ª–∏ Alembic

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

storage.py ‚Äî –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

migrations/env.py ‚Äî –¥–ª—è Alembic –º–∏–≥—Ä–∞—Ü–∏–π

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:
–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ –ª—é–±–æ–π –º–∞—à–∏–Ω–µ –∏–ª–∏ –Ω–æ—Å–∏—Ç–µ–ª–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
–ú–µ—Å—Ç–æ	–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–§–ª–µ—à–∫–∞	SQLite: sqlite:///db/librarian.db
–Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫	SQLite –∏–ª–∏ PostgreSQL —Å –¥—Ä—É–≥–∏–º –ø—É—Ç—ë–º
Google Colab	sqlite:////content/... –∏–ª–∏ GDrive
Alembic	URL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π DATABASE_URL
"""